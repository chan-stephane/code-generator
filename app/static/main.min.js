function update_type(){"bar-code"==event.target.value?($("#background").attr("disabled","disabled"),$("#foreground").attr("dishttps://code-generator.chan-stephane.me/abled","disabled"),$("#form-code").attr("disabled","disabled"),$("#image-link").attr("disabled","disabled")):($("#background").removeAttr("disabled"),$("#foreground").removeAttr("disabled"),$("#form-code").removeAttr("disabled"),$("#image-link").removeAttr("disabled"))}function initializeMode(){$('input[name="mode"]').on("change",(function(){const e=$(this).val();"generate"===e?($("#form-read").removeClass().addClass("hidden"),$("#form-generate").removeClass(),$("#img-div").empty()):"read"===e&&($("#form-generate").removeClass().addClass("hidden"),$("#form-read").removeClass(),$("#img-div").empty())}))}function isHexadecimal(e){return/^#([0-9A-Fa-f]{6}|[0-9A-Fa-f]{3})$/.test(e)}function isValidForm(e){return["square","gapped_square","circle","rounded","vertical_bar","horizontal_bar"].includes(e)}function copy(){var e=$(event.target),a=e.closest("div").prev().find("input").val();e.text("Copied!"),navigator.clipboard.writeText(a).then((function(){e.text("Copied!"),Toastify({text:"Data copied!",backgroundColor:"rgb(75, 230, 134)",close:!0}).showToast()})).catch((function(a){e.text("Failed!"),Toastify({text:"Failed to copy!",backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast()}))}async function callGenerate(e,a){return new Promise(((t,o)=>{let r="Error on generate qr code";$.ajax({url:e,type:"POST",data:JSON.stringify(a),contentType:"application/json",xhr:function(){var e=new XMLHttpRequest;return e.onreadystatechange=function(){2==e.readyState&&(200==e.status?e.responseType="blob":e.responseType="json"),4==e.readyState&&e.response&&e.response.error&&(r=e.response.error)},e},success:function(e){t(e)},error:function(e,a,t){o(r)}})}))}function load(){$("#copyright").text(` © ${(new Date).getFullYear()} Stéphane CHAN HIOU KONG`)}function loaderComponent(){var e=$("<div>").addClass("w-10 h-10 border-4 border-t-blue-500 border-gray-300 rounded-full animate-spin");$("#img-div").empty().append(e)}function loadResult(e){e.forEach((e=>{var a=$("<div>").addClass("flex items-center gap-x-3 p-2"),t=$("<img>").attr({src:`data:image/png;base64, ${e.image_base64}`,class:"w-16 h-16"}),o=$("<div>").addClass("ml-5"),r=$("<input>").attr({class:"w-full p-4 text-gray-800 bg-white disabled:opacity-80 border rounded-md shadow-sm block focus:border-indigo-600 font-medium",type:"text",value:e.text,disabled:"disabled"}),n=$("<div>").addClass("ml-5"),d=$("<button>").attr({class:"p-4 bg-indigo-600 text-white rounded-md",onclick:"copy()"}).text("Copy");o.append(r),n.append(d),a.append(t),a.append(o),a.append(n),$("#img-div").append(a)}))}async function read(){loaderComponent();var e=new FormData,a=$("#image-file")[0];if(a.files.length>0){var t=a.files[0],o=window.location.origin+"/read";if(-1===["image/jpeg","image/jpg","image/png"].indexOf(t.type))return Toastify({text:"Please upload a valid image file (JPEG, PNG).",backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast(),void $("#img-div").empty();e.append("file",t),$.ajax({url:o,type:"POST",data:e,contentType:!1,processData:!1,success:function(e){e.length>0?($("#img-div").empty(),loadResult(e),Toastify({text:"Reading code successfully",backgroundColor:"rgb(75, 230, 134)",close:!0}).showToast()):(Toastify({text:"No qr code or bar code found in the image.",backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast(),$("#img-div").empty())},error:function(e,a,t){Toastify({text:t,backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast(),$("#img-div").empty()}})}else Toastify({text:"Please upload an image file.",backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast(),$("#img-div").empty()}async function generate(){loaderComponent();var e=$("#type-code").find(":selected").val(),a=$("#data").val(),t=window.location.origin,o={data:a};if("qr-code"==e){let e=$("#background").val(),a=$("#foreground").val(),t=$("#form-code").val();o.bg_color=isHexadecimal(e)?e:"#ffffff",o.color=isHexadecimal(a)?a:"#000000",o.style_points=isValidForm(t)?t:"square",o.image_url=$("#image-link").val()}try{const a=await callGenerate(t+"/"+e+"/generate",o);var r=URL.createObjectURL(a),n=r;if("qr-code"==e){const a=await callGenerate(t+"/"+e+"/download",o);n=URL.createObjectURL(a)}Toastify({text:"Generated successfully",backgroundColor:"rgb(75, 230, 134)",close:!0}).showToast();var d=$("<img>").attr("src",r).addClass("w-50 h-50");$("#img-div").append(d);var i=$("<a>").attr({href:n,id:"btn-dwn",download:"code_by_code-generator.png",class:"ml-4 mt-2 px-4 py-2 bg-indigo-600 text-white rounded-full inline-flex items-center justify-center"}).text("Download Image");$("#btn-dwn").length>0&&$("#btn-dwn").remove(),$("#btn").after(i),$("#img-div").empty().append(d)}catch(e){$("#img-div").empty(),$("#btn-dwn").length>0&&$("#btn-dwn").remove(),Toastify({text:e,backgroundColor:"rgb(230, 108, 81)",close:!0}).showToast()}}$(document).ready((function(){load(),initializeMode()}));